@model ShowRecoveryCodesModel
@{
    ViewData["Title"] = "کدهای بازیابی";
}

<partial name="_StatusMessage" for="StatusMessage" />
<h4>@ViewData["Title"]</h4>
<div class="alert alert-warning" role="alert">
    <p>
        <span class="fa-solid fa-triangle-exclamation"></span>
        <strong>این کدهای بازیابی را در مکانی امن نگه دارید.</strong>
    </p>
    <p>
        اگر دسترسی به دستگاه احراز هویت خود را از دست بدهید، می‌توانید از این کدها برای ورود به سیستم استفاده کنید.
        <strong>هر کد فقط یک بار قابل استفاده است.</strong>
        اگر تمام کدهای بازیابی خود را استفاده کردید، می‌توانید کدهای جدید ایجاد کنید.
    </p>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="recovery-codes-container p-3 border rounded bg-light" id="recovery-codes-container">
            @foreach (var code in Model.RecoveryCodes)
            {
                <code class="d-block mb-2 recovery-code">@code</code>
            }
        </div>
    </div>
</div>
<div class="mt-3">
    <button type="button" class="btn btn-success me-2" id="downloadCodesBtn">
        <i class="fa-solid fa-download"></i> دانلود کدها
    </button>
    <a asp-action="TwoFactorAuthentication" class="btn btn-primary">تایید</a>
</div>

@section Styles {
    <style>
        .recovery-codes-container {
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
        }
        .recovery-code {
            font-size: 1.1em;
            padding: 5px;
            background-color: #fff;
            border: 1px solid #dee2e6;
        }
    </style>
}

@section Scripts {
    <script>
        document.getElementById('downloadCodesBtn').addEventListener('click', function() {
            // Get all recovery codes
            var codes = [];
            var codeElements = document.querySelectorAll('.recovery-code');
            codeElements.forEach(function(element) {
                codes.push(element.textContent.trim());
            });
            
            // Create file content
            var content = 'کدهای بازیابی احراز هویت دو مرحله ای\n';
            content += '==========================================\n\n';
            content += 'تاریخ ایجاد: ' + new Date().toLocaleString('fa-IR') + '\n\n';
            content += 'هشدار: این کدها را در مکانی امن نگه دارید.\n';
            content += 'هر کد فقط یک بار قابل استفاده است.\n\n';
            content += 'کدهای بازیابی:\n';
            content += '==========================================\n';
            codes.forEach(function(code, index) {
                content += (index + 1) + '. ' + code + '\n';
            });
            content += '\n==========================================\n';
            content += 'این کدها را حذف نکنید!\n';
            
            // Create blob and download
            var blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            var url = window.URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'recovery-codes-' + new Date().getTime() + '.txt';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        });
    </script>
}
